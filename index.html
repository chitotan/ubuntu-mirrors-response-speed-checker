<!DOCTYPE html>
<html>
  <head prefix="og: https://ogp.me/ns#">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Ubuntu Mirrors Response Speed Cheacker"/>
    <meta property="og:description" content="Ubuntuの全アーカイブミラーサーバーの応答速度のテストを行います。処理はクライアント側でやってるので激重ですので参考までに。"/>
    <meta property="og:type" content="article"/>
    <meta name="description" content="Ubuntuの全アーカイブミラーサーバーの応答速度のテストを行います。処理はクライアント側でやってるので激重ですので参考までに。"/>
    <title>Ubuntu Mirrors Response Speed Cheacker</title>
  </head>
  <body>
    <h1>Ubuntu Mirrors Response Speed Cheacker</h1>
    <a>Ubuntuの全アーカイブミラーサーバーの応答速度のテストを行います。</a>
    <a>処理はクライアント側でやってるので激重ですので参考までに。</a>
    <table id="result-table">
      <tr>
        <th>URL</th>
        <th>Response Time (ms)</th>
      </tr>
    </table>
    <script>
      const urlFile = 'allservers.txt';
      const table = document.getElementById('result-table');
// fetchが終わった後に、response time順にsortしてから表示
      fetch(urlFile)
        .then(response => response.text())
        .then(text => {
          const urls = text.split('\n');
          urls.forEach(url => {
            const start = performance.now();
            fetch(url, {mode: 'no-cors'})
              .then(response => {
                const end = performance.now();
                const row = table.insertRow();
                row.insertCell().innerHTML = url;
                row.insertCell().innerHTML = (end - start).toFixed(2);
              })
              .catch(error => console.log(error));
          });
        })
        // 表示された行のresponse time順にsortする
        .then(() => {
          let rows, switching, i, x, y, shouldSwitch;
          switching = true;
          while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < (rows.length - 1); i++) {
              shouldSwitch = false;
              x = rows[i].getElementsByTagName("TD")[1];
              y = rows[i + 1].getElementsByTagName("TD")[1];
              if (Number(x.innerHTML) > Number(y.innerHTML)) {
                shouldSwitch = true;
                break;
              }
            }
            if (shouldSwitch) {
              rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
              switching = true;
            }
          }
        })
        .catch(error => console.log(error));
    </script>
    <footer>
      <p class="copy"><small>
          &copy; 2019<script>new Date().getFullYear()>2019&&document.write("-"+new Date().getFullYear());</script>, chitoheymu_kakka
        </small></p>
  </footer>
  </body>
</html>